name: Evaluate model on current branch and baseline model on master branch

on:
  pull_request:
    branches: [ master ]

jobs:
  evaluate:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        # Checkout current branch
        with:
          path: current-branch

      - name: Set up Python 3.10.4
        uses: actions/setup-python@v3
        with:
          python-version: 3.10.4

      - name: Install pipenv
        uses: dschep/install-pipenv-action@v1

      - name: Install pipenv packages
        working-directory: ./current-branch
        run: pipenv install

      - name: Create model folder
        working-directory: ./current-branch
        run: mkdir -p model

      - name: Evaluate new model
        working-directory: ./current-branch
        run: pipenv run python model.py

      - name: Print stats
        working-directory: ./current-branch
        run: cat train_result.csv

      
      - uses: actions/checkout@v3
        # Checkout master branch
        with:
          path: master-branch
          ref: master

      - name: Install pipenv packages
        working-directory: ./master-branch
        run: pipenv install

      - name: Create model folder
        working-directory: ./current-branch
        run: mkdir -p model

      - name: Evaluate baseline model
        working-directory: ./master-branch
        run: pipenv run python model.py

      - name: Print stats
        working-directory: ./master-branch
        run: cat train_result.csv
